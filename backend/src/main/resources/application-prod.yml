# ============================================================
# FIELDZ - Profil PRODUCTION (prod)
# ============================================================
# Active automatiquement sur Render via SPRING_PROFILES_ACTIVE=prod
# ============================================================

spring:
  # Base de donnees PostgreSQL
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/fieldz}
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME:}
    password: ${DB_PASSWORD:}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 30000
      connection-timeout: 20000
      max-lifetime: 1800000

  # JPA / Hibernate
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        jdbc:
          batch_size: 25
        order_inserts: true
        order_updates: true

  # Flyway - Migrations automatiques
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    validate-on-migrate: true

  # H2 desactive en prod
  h2:
    console:
      enabled: false

  # DevTools desactive en prod
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false

# ============================================================
# Logging minimal en prod
# ============================================================
logging:
  level:
    root: WARN
    com.fieldz: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.hibernate: WARN
    org.flywaydb: INFO

# ============================================================
# JWT - Duree courte en prod pour la securite
# ============================================================
jwt:
  access:
    expMinutes: ${JWT_ACCESS_EXP_MINUTES:15}
  refresh:
    expDays: ${JWT_REFRESH_EXP_DAYS:7}

# ============================================================
# CORS - Frontend production uniquement
# ============================================================
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:}

# ============================================================
# Securite - Cookies securises (HTTPS obligatoire)
# ============================================================
security:
  cookies:
    domain: ${COOKIE_DOMAIN:}
    secure: true

# ============================================================
# URLs production
# ============================================================
app:
  frontend-url: ${FRONTEND_URL:}
  backend-url: ${BACKEND_URL:}

# ============================================================
# Swagger desactive en prod (securite)
# ============================================================
springdoc:
  swagger-ui:
    enabled: false
  api-docs:
    enabled: false

# ============================================================
# Actuator - Health checks pour Render
# ============================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: never
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true

# ============================================================
# Serveur - Optimisations prod
# ============================================================
server:
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain
    min-response-size: 1024
  error:
    include-stacktrace: never
    include-message: never

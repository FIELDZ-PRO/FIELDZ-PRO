# ============================================================
# FIELDZ - Profil PRODUCTION (prod)
# ============================================================
# Active automatiquement sur Render via SPRING_PROFILES_ACTIVE=prod
# ============================================================

spring:
  # Base de donnees PostgreSQL
  datasource:
    url: ${DATABASE_URL:jdbc:postgresql://localhost:5432/fieldz}
    driver-class-name: org.postgresql.Driver
    username: ${DB_USERNAME:}
    password: ${DB_PASSWORD:}
    hikari:
      maximum-pool-size: 10
      minimum-idle: 2
      idle-timeout: 30000
      connection-timeout: 20000
      max-lifetime: 1800000

  # JPA / Hibernate
  jpa:
    database-platform: org.hibernate.dialect.PostgreSQLDialect
    hibernate:
      ddl-auto: update
    show-sql: false
    properties:
      hibernate:
        format_sql: false
        jdbc:
          batch_size: 25
        order_inserts: true
        order_updates: true

  # Flyway - Migrations automatiques
  flyway:
    enabled: true
    baseline-on-migrate: true
    locations: classpath:db/migration
    validate-on-migrate: true

  # H2 desactive en prod
  h2:
    console:
      enabled: false

  # DevTools desactive en prod
  devtools:
    restart:
      enabled: false
    livereload:
      enabled: false

# ============================================================
# Logging minimal en prod
# ============================================================
logging:
  level:
    root: WARN
    com.fieldz: INFO
    org.springframework.security: WARN
    org.springframework.web: WARN
    org.hibernate: WARN
    org.flywaydb: INFO

# ============================================================
# JWT - Duree courte en prod pour la securite
# ============================================================
jwt:
  access:
    expMinutes: ${JWT_ACCESS_EXP_MINUTES:30}
  refresh:
    expDays: ${JWT_REFRESH_EXP_DAYS:7}

# ============================================================
# CORS - Frontend production uniquement
# ============================================================
cors:
  allowed-origins: ${CORS_ALLOWED_ORIGINS:https://fieldz-pro.vercel.app}

# ============================================================
# Securite - Cookies securises (HTTPS obligatoire)
# ============================================================
security:
  cookies:
    domain: ${COOKIE_DOMAIN:}  # Empty recommended for production
    secure: true               # Required for HTTPS

# ============================================================
# URLs production (deployed versions)
# ============================================================
app:
  frontend-url: ${FRONTEND_URL:https://fieldz-pro.vercel.app}
  backend-url: ${BACKEND_URL:https://fieldz-pro.koyeb.app}
  cookie:
    same-site: None  # Required for cross-origin (frontend â‰  backend domain)
    secure: true     # Required for HTTPS and SameSite=None
    domain: ""       # Empty - browser will use current domain
    path: /api/auth

# ============================================================
# Swagger desactive en prod (securite)
# ============================================================
springdoc:
  swagger-ui:
    enabled: false
  api-docs:
    enabled: false

# ============================================================
# Actuator - Health checks pour Render
# ============================================================
management:
  endpoints:
    web:
      exposure:
        include: health,info
      base-path: /actuator
  endpoint:
    health:
      show-details: never
      probes:
        enabled: true
  health:
    livenessstate:
      enabled: true
    readinessstate:
      enabled: true

# ============================================================
# Serveur - Optimisations prod
# ============================================================
server:
  compression:
    enabled: true
    mime-types: application/json,application/xml,text/html,text/xml,text/plain
    min-response-size: 1024
  error:
    include-stacktrace: never
    include-message: never

# ============================================================
# Required Environment Variables for Production
# ============================================================
# Set these on your deployment platform (Koyeb, Render, etc.):
#
# SPRING_PROFILES_ACTIVE=prod
#
# Database:
# DATABASE_URL=jdbc:postgresql://host:port/database
# DB_USERNAME=your_db_user
# DB_PASSWORD=your_db_password
#
# Application URLs:
# FRONTEND_URL=https://fieldz-pro.vercel.app
# BACKEND_URL=https://fieldz-pro.koyeb.app
# CORS_ALLOWED_ORIGINS=https://fieldz-pro.vercel.app
#
# Security:
# COOKIE_DOMAIN="" (empty recommended)
# COOKIE_SECURE=true (automatically set in this profile)
# COOKIE_SAME_SITE=None (automatically set in this profile)
#
# Email (Gmail SMTP):
# MAIL_USERNAME=contact.fieldz@gmail.com
# MAIL_PASSWORD=your-app-password
#
# OAuth2 Google:
# GOOGLE_CLIENT_ID=your-client-id
# GOOGLE_CLIENT_SECRET=your-client-secret
#
# Cloudinary:
# CLOUDINARY_CLOUD_NAME=your-cloud-name
# CLOUDINARY_API_KEY=your-api-key
# CLOUDINARY_API_SECRET=your-api-secret
#
# JWT Keys:
# JWT_RS256_PRIVATE=keys/private.pem
# JWT_RS256_PUBLIC=keys/public.pem
# JWT_ACCESS_EXP_MINUTES=15
# JWT_REFRESH_EXP_DAYS=7
